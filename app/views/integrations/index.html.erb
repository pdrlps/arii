<% content_for :title, "Integrations - #{ENV["APP_TITLE"]}" %>
<ul class="breadcrumbs">
  <li><a href="<%= root_url %>">Home</a></li>
  <li class="current">Integrations</li>
</ul>
<div data-alert class="alert-box secondary radius">
  Got any trouble creating new integrations? <a href="#" data-reveal-id="integrations_demo_video"><strong>Check the demo video</strong></a>.
  <a href="#" class="close">&times;</a>
</div>
<h1>Integrations</h1>
<!-- main content -->
<% unless flash[:notice].nil? then %>
<div data-alert class="alert-box warning radius">
  <%= flash[:notice].html_safe %>
  <a href="#" class="close">&times;</a>
</div>
<% end %>
<div class="small-9 columns">
  <% if @integrations.empty? %>
  <div class="row">
    <div class="small-12 columns">
      <p><strong>Integrations</strong> control your integration flow, connecting intelligent <%= link_to 'agents'.html_safe, {:controller => '/agents'}, :class => ''%> with delivery <%= link_to 'endpoints', {:controller => '/templates'}, :class => '' %>.</p>
      <% if current_user.agents.empty? %>
      <h5 class="subheader">Start by creating a <%= link_to 'new agent', new_agent_path, :title => 'Create new agent', :class => '', :data => { :tooltip => ''} %></h5>
      <% else %>
      <% if current_user.templates.empty? %>
      <h5 class="subheader">You have agents, now add a <%= link_to 'new endpoint', new_template_path, :class => '' %></h5>
      <% else %>
      <h5 class="subheader">Your agents and endpoints are ready, create a <%= link_to 'new integration'.html_safe, new_integration_path, :class => '' %></h5>
      <% end %>
      <% end %>
    </div>
  </div>
  <% else %>
  <h3 class="subheader">Integrations</h3>
  <% @integrations.each do |integration| %>
  <div id="integration_details_<%= integration.id %>" class="row agent-info <%= (integration.status != 400) ? 'info-enabled' : 'info-disabled'  %>">
    <div class="small-11 columns left">
      <h6 class="subheader"><%= integration.title %></h6>
      <div class="row">
        <div class="small-5 columns">
          <ul class="no-bullet">
            <% integration.agents.each do |agent| %>
            <li>
              <%= link_to agent.title, agent %>
              <span class="label secondary radius icon-publisher"> <%= agent.publisher %></span>
              <span class="label secondary radius icon-schedule"> <%= agent.schedule %></span>
            </li>
            <% end %>
          </ul>
        </div>
        <div class="small-1 columns icon-forward">
        </div>
        <div class="small-5 columns">
          <ul class="no-bullet">
            <% integration.templates.each do |template| %>
            <li><%= link_to template.title, template %>
            <span class="label secondary radius icon-publisher"><%= template.publisher %></span></li>
            <% end %>
          </ul>
        </div>
        <div class="small-1 columns">
          &nbsp;
        </div>
      </div>
    </div>
    <div class="small-1 columns right">
      <%
      if integration.status == 100
      %>
      <span class="has-tip tip-right radius action right" id="integration_play_<%= integration.id %>" data-tooltip title="Execute <%=integration.title%>"><%= link_to '', {:controller => 'integrations', :action => 'execute', :id => integration.id}, :class => 'icon-play',:title => "Execute #{integration.title}" %></span>
      <span class="has-tip tip-right radius action right " id="integration_pause_<%= integration.id %>" data-tooltip title="Disable <%=integration.title%>"><a data-id="<%= integration.id %>" class="integration_pause icon-pause" href="#">&nbsp; </a></span>
      <% else %>
      <span class="has-tip tip-right radius action right " id="integration_play_<%= integration.id %>" data-tooltip title="Enable <%=integration.title%>"><a href="#" class="icon-play integration_play" title="Play <%= integration.title %>" data-id="<%= integration.id %>">&nbsp; </a></span>
      <% end
      %>
      <span class="has-tip tip-right radius action right" data-tooltip title="Edit <%=integration.title%>"><%= link_to '', edit_integration_path(integration), :class => '  icon-settings' %></span>
      <span class="has-tip tip-right radius action right" data-tooltip title="View <%=integration.title%>"><%= link_to '', integration, :class => '  icon-view' %></span>
      <br>
    </div>
  </div>
  <% end %>
  <h5 class="subheader">Create a <%= link_to 'new integration'.html_safe, new_integration_path, :class => '' %></h5>
  <% end %>
  <hr>
  <h5 class="subheader">or <strong>add a sample integration</strong></h5>
  <div class="row agent-info info-enabled">
    <div class="small-11 columns">
      <div class="left">
      </div>
      <div class="info-details">
        <h6 class="subheader">SQL to CSV file</h6>
        <span class="label radius secondary icon-publisher">sql</span>
        <span class="label radius secondary icon-schedule">1d</span>
        <span class="icon-forward"></span>
        <span class="label radius secondary radius icon-publisher">file</span>
      </div>
    </div>
    <div class="small-1 columns right">
      <div class="right">
        <span class="has-tip tip-right radius action right" data-tooltip title="Add SQL results to CSV file sample integration"><%= link_to ''.html_safe, {:controller => 'integrations', :action => 'add', :agent => 'sql', :template => 'file'}, :class => 'action right icon-add', :title => "Add SQL results to CSV file sample integration" %></span>
      </div>
    </div>
  </div>
  <div class="row agent-info info-enabled">
    <div class="small-11 columns">
      <div class="left">
      </div>
      <div class="info-details">
        <h6 class="subheader">XML to SQL table</h6>
        <span class="label radius secondary radius icon-publisher">xml</span>
        <span class="label radius secondary radius icon-schedule">1h</span>
        <span class="icon-forward"></span>
        <span class="label radius secondary radius icon-publisher">sql</span>
      </div>
    </div>
    <div class="small-1 columns right">
      <div class="right">
        <span class="has-tip tip-right radius action right" data-tooltip title="Add XML to SQL table integration"><%= link_to ''.html_safe, {:controller => 'integrations', :action => 'add', :agent => 'xml', :template => 'sql'}, :class => 'action right icon-add', :title => "Add XML to SQL table integration" %></span>
      </div>
    </div>
  </div>
</div>
<!-- sidebar -->
<div class="small-3 columns">
  <% if current_user.agents.empty? %>
  <%= link_to 'New Agent', new_agent_path, :title => 'Create new agent', :class => 'button small radius icon-agent' %>
  <% else %>
  <% if current_user.templates.empty? %>
  <%= link_to ' New Template', new_template_path, :class => 'button small radius icon-template' %>
  <% else %>
  <%= link_to ' New Integration'.html_safe, new_integration_path, :class => 'button small radius icon-integration' %>
  <% end %>
  <% end %>
  <h4>Go to</h4>
  <ul class="no-bullet">
    <li><%= link_to 'Agents'.html_safe, {:controller => '/agents'}, :class => 'icon-agent', :title => 'Go to Agents'%></li>
    <li><%= link_to 'Endpoints'.html_safe, {:controller => '/templates'}, :class => 'icon-template', :title => 'Go to Endpoints'%></li>
    <li><%= link_to 'Files', {:controller => '/files', :action => 'index'}, :class => 'icon-files', :title => 'Go to Files' %></li>
  </ul>
  <%= render partial: "helper/event_list"  %>
</div>
<div id="integrations_demo_video" class="reveal-modal large" data-reveal>
  <h2>Integrations Demo Video</h2>
  <div class="flex-video widescreen vimeo" style="display: block;">
    <iframe width="1280" height="720" src="http://www.youtube-nocookie.com/embed/wQJyzTGA5vQ?rel=0" frameborder="0" allowfullscreen="" data-src="http://www.youtube-nocookie.com/embed/wQJyzTGA5vQ?rel=0"></iframe>
  </div>
  <a class="close-reveal-modal">&#215;</a>
</div>